# pico CTF write up
* * *
## Web Wxploitation
### 1. Insp3ct0r - Points: 50 - (Solves: 11121)
  (problem)
  Kishor Balan tipped us off that the following code may need inspection: https://2019shell1.picoctf.com/problem/9509/ (link) or http://2019shell1.picoctf.com:9509

  (answer)
  developper tool(F12)を用いる。searchでflagを検索すると1/3ずつ書いてあるから、それを結合してflagの完成。
### 2. dont-use-client-side - Points: 100 - (Solves: 9279)
(problem)
Can you break into this super secure portal? https://2019shell1.picoctf.com/problem/21888/ (link) or http://2019shell1.picoctf.com:21888

(answer)
developper toolでsourceコードを見ると、password認証がwebのコード上で行われている（下記）
~~~javascript
function verify() {
    checkpass = document.getElementById("pass").value;
    split = 4;
    if (checkpass.substring(0, split) == 'pico') {
      if (checkpass.substring(split*6, split*7) == '6a8e') {
        if (checkpass.substring(split, split*2) == 'CTF{') {
         if (checkpass.substring(split*4, split*5) == 'ts_p') {
          if (checkpass.substring(split*3, split*4) == 'lien') {
            if (checkpass.substring(split*5, split*6) == 'lz_5') {
              if (checkpass.substring(split*2, split*3) == 'no_c') {
                if (checkpass.substring(split*7, split*8) == 'b}') {
                  alert("Password Verified")
                  }
                }
              }
~~~
text boxへの入力がcheckpassに渡されてそれを条件に照らし合わせて、判別している。
順番につなげていけばpasswordが判明する。'picoCTF{no_clients_plz_56a8eb}'
### 3.logon - Points: 100 - (Solves: 5988)
(problem)
The factory is hiding things from all of its users. Can you login as logon and find what they've been looking at? https://2019shell1.picoctf.com/problem/49907/ (link) or http://2019shell1.picoctf.com:49907

(answer)
適当なusernameとpasswordでlog in自体は成功するが、管理者としてlog onするにはadminとして入らなければいけない。developper toolのNetwork, All, cookieを見るとadmin=Falseになっている。
これをgoogleのcookie編集toolで編集することを考える。loginした状態で, cookie:admin = Trueにしてページ更新を行う(log in実行時にadmin=Falseが強制的に書き換えられるため)。とflagが獲得できる。"picoCTF{th3_c0nsp1r4cy_l1v3s_9e21365b}"
[cookieについて](https://boxil.jp/mag/a2856/)
### 4. where are the robots - Points: 100 - (Solves: 6909)
(problem)
Can you find the robots? https://2019shell1.picoctf.com/problem/4159/ (link) or http://2019shell1.picoctf.com:4159

(answer)
robotsというwebクローロングの指示を行うrobots.txtをみつけれて自分もその指示に従えばよい。URLに/robots.txtを付け加えてアクセスすると
~~~
User-agent: *
Disallow: /a44f7.html
~~~
と表示される。ここにアクセスするとflagを獲得できる。"picoCTF{ca1cu1at1ng_Mach1n3s_a44f7}"
### 5. Client-side-again - Points: 200 - (Solves: 4714)　　
(problem)
Can you break into this super secure portal? https://2019shell1.picoctf.com/problem/4163/ (link) or http://2019shell1.picoctf.com:4163

(answer)
developper toolでsourceをみると、これもフロントでパスワード認証している。ただし、難読化がしてある。
認証を行うsourceコードは以下
~~~javascript
<script type="text/javascript">
  var _0x5a46=['a9191}','_again_e','this','Password\x20Verified',
    'Incorrect\x20password','getElementById','value','substring','picoCTF{','not_this'];

  (function(_0x4bd822,_0x2bd6f7){
    var _0xb4bdb3=function(_0x1d68f6){
      while(--_0x1d68f6){
        _0x4bd822['push'](_0x4bd822['shift']());}
      };
    _0xb4bdb3(++_0x2bd6f7);
  }(_0x5a46,0x1b3));

  var _0x4b5b=function(_0x2d8f05,_0x4b81bb){
    _0x2d8f05=_0x2d8f05-0x0;
    var _0x4d74cb=_0x5a46[_0x2d8f05];
    return _0x4d74cb;};

  function verify(){checkpass=document[_0x4b5b('0x0')]('pass')[_0x4b5b('0x1')];
    split=0x4;
    if(checkpass[_0x4b5b('0x2')](0x0,split*0x2)==_0x4b5b('0x3'))
      {if(checkpass[_0x4b5b('0x2')](0x7,0x9)=='{n')
        {if(checkpass[_0x4b5b('0x2')](split*0x2,split*0x2*0x2)==_0x4b5b('0x4'))
          {if(checkpass[_0x4b5b('0x2')](0x3,0x6)=='oCT')
            {if(checkpass[_0x4b5b('0x2')](split*0x3*0x2,split*0x4*0x2)==_0x4b5b('0x5'))
              {if(checkpass['substring'](0x6,0xb)=='F{not')
                {if(checkpass[_0x4b5b('0x2')](split*0x2*0x2,split*0x3*0x2)==_0x4b5b('0x6'))
                  {if(checkpass[_0x4b5b('0x2')](0xc,0x10)==_0x4b5b('0x7')){alert(_0x4b5b('0x8'));
                  }}}}}}}
        }
      else{alert(_0x4b5b('0x9'));}}
</script>
~~~
やってることを丁寧に見ていくと、var _0x5a46を0x1b3(255+176+3)回shift（結果的に4回右にshift）
checkpass = getElementById('pass').valueで入力した文字列を取得して.substringにかけている。
あとは、_0x4b5bのlistからしていされたindexに対応するvalueを並べていくとflagを獲得できる。
'picoCTF{not_this_again_ea9191}'

### 6. Open-to-admins - Points: 200 - (Solves: 3134)
(problem)
This secure website allows users to access the flag only if they are admin and if the time is exactly 1400. https://2019shell1.picoctf.com/problem/37878/ (link) or http://2019shell1.picoctf.com:37878

(answer)
sign in 画面は無意味らしいことがわかるので、flagボタンをクリックすると"I'm sorry it doesn't look like you are the admin or it's the incorrect time."などと言われるので適切な時間にadminとしてflagボタンを押さなければならない。
cookieを新しくつくればよい。問題文に丁寧にtime=1400と書いてあるので従う。admin = True, time = 1400とcookieを追加してflagボタンをクリックするとflagが獲得できる。"Flag: picoCTF{0p3n_t0_adm1n5_2e8d3883}"

### 7.picobrowser - Points: 200 - (Solves: 4753)
(problem)
This website can be rendered only by picobrowser, go and catch the flag! https://2019shell1.picoctf.com/problem/37829/ (link) or http://2019shell1.picoctf.com:37829

(answer)
指定のbrowser(picobrowser)でしか見れないサイトにアクセスする問題。curlでheader付与かAgent指定するオプションがあるのでそれを用いる。
[curl](https://qiita.com/ryuichi1208/items/e4e1b27ff7d54a66dcd9), [curl2](https://qiita.com/matsuyoro/items/8ddff37068dfe8e3b665)
~~~shell
 curl -A "picobrowser"  https://2019shell1.picoctf.com/problem/37829/flag | grep pico
 or
 curl -H "User-Agent: picobrowser"  https://2019shell1.picoctf.com/problem/37829/flag | grep pico
~~~

### 8. Irish-Name-Repo 1 - Points: 300 - (Solves: 2759)
(problem)
There is a website running at https://2019shell1.picoctf.com/problem/32241/ (link) or http://2019shell1.picoctf.com:32241. Do you think you can log us in? Try to see if you can login!

(answer)
指定されたサイトのサポートをみると、これがSQLで作られていることがわかる。のでSQL injectionを試す。
例
~~~
user =  'or'1'='1' --
pass = any
~~~
'picoCTF{s0m3_SQL_0397f20c}'

### 9. Irish-Name-Repo 2 - Points: 350 - (Solves: 1752)
(problem)
There is a website running at https://2019shell1.picoctf.com/problem/14912/ (link). Someone has bypassed the login before, and now it's being strengthened. Try to see if you can still login! or http://2019shell1.picoctf.com:14912

(answer)
SQL injectionの問題。特定の文字列でSQL injectionがdetectされるのでそれを回避する。半角スペースと'でerrorを吐くので突破口はやはりここ。
いろいろ試すけど、filter回避は難しい。コメントアウトのハイフン2つ'--'を入れてもSQLi detectedにならずにlogin failedになるのでコメントアウトはfilterされないことがわかる。(同時にusernameも特定のものを入力しなければならないことに気づく。試しにadminを指定する。）
~~~
user = admin' --
pass = any
~~~
でlog in成功。'picoCTF{m0R3_SQL_plz_752d1173}'を獲得。

### 9.Empire1 - Points: 400 - (Solves: 632)
(problem)  
Psst, Agent 513, now that you're an employee of Evil Empire Co., try to get their secrets off the company website. https://2019shell1.picoctf.com/problem/4155/ (link) Can you first find the secret code they assigned to you? or http://2019shell1.picoctf.com:4155  

(answer)  
loginのページではとくにSQL injectionできそうにない。（そういうserver errorが現れない）loginしたあと、Add todoがあるが、そこで, a'などをためしにうつとserver errorが起きるのでここがSQL injectionできそう。おそらく入力はsinge quatationで囲ってあるので'||(some_query)||'の形で入力したらsome_queryの結果がyour todo に反映されると考えられる。さて、some_queryであるが、databese management systemがmy_sqlなのかsqliteなのかわからない。MySQLの場合 information_schemaの中にデータベースの情報が格納されている。some_query = SELECT table_name FROM information_schema.tablesでなにか応答があればMySQLであるとおもわれる。今回はsqliteだったのでsome_query = SELECT group_concate(sql) FROM sqlite_masterでデータベースを構築する際のsql文がすべて入手できる。group_concateしないと一番最初のsqlしかでてこないので注意。ここで得られたsqlの中のuserテーブルにsecretとかいういかにも怪しいカラム名が表示されているので、再度'||(SELECT group_concate(secret) FROM user)||'をadd to doに入力すればflagが獲得できる。
